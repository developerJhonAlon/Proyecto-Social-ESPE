/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ec.edu.espe_innovativa.controller;

import ec.edu.espe_ctt.saturno.entity.Stvcamp;
import ec.edu.espe_ctt.saturno.entity.Stvmajr;
import ec.edu.espe_ctt.saturno.entity.Stvsubj;
import ec.edu.espe_ctt.saturno.session.StvcampFacade;
import ec.edu.espe_ctt.saturno.session.StvmajrFacade;
import ec.edu.espe_ctt.saturno.session.StvsubjFacade;
import ec.edu.espe_ctt.seguridades.entity.SegUsuario;
import ec.edu.espe_ctt.vinculacion.entity.AvanceActividad;
import ec.edu.espe_ctt.vinculacion.entity.CarreraPrograma;
import ec.edu.espe_ctt.vinculacion.entity.CarreraProyecto;
import ec.edu.espe_ctt.vinculacion.entity.Cobertura;
import ec.edu.espe_ctt.vinculacion.entity.DepartamentoProyecto;
import ec.edu.espe_ctt.vinculacion.entity.Estado;
import ec.edu.espe_ctt.vinculacion.entity.LineaInvestigacionProyecto;
import ec.edu.espe_ctt.vinculacion.entity.LocalizacionPrograma;
import ec.edu.espe_ctt.vinculacion.entity.ObjetivoPrograma;
import ec.edu.espe_ctt.vinculacion.entity.PresupuestoProyecto;
import ec.edu.espe_ctt.vinculacion.entity.Programa;
import ec.edu.espe_ctt.vinculacion.entity.ProgramaReporte;
import ec.edu.espe_ctt.vinculacion.entity.Proyecto;
import ec.edu.espe_ctt.vinculacion.entity.ProyectoReporte;
import ec.edu.espe_ctt.vinculacion.entity.ResponsableProyecto;
import ec.edu.espe_ctt.vinculacion.entity.TipoProyecto;
import ec.edu.espe_ctt.vinculacion.entity.TipoResponsable;
import ec.edu.espe_ctt.vinculacion.entity.VDocenteVinculacion2;
import ec.edu.espe_ctt.vinculacion.session.ProgramaFacade;
import ec.edu.espe_ctt.vinculacion.session.VDocenteVinculacion2Facade;
import ec.edu.espe_ctt_investigacion.entity.SeaCanton;
import ec.edu.espe_ctt_investigacion.entity.SeaLineainves;
import ec.edu.espe_ctt_investigacion.entity.SeaParametros;
import ec.edu.espe_ctt_investigacion.entity.SeaParametrosDet;
import ec.edu.espe_ctt_investigacion.entity.SeaParroquia;
import ec.edu.espe_ctt_investigacion.entity.SeaProvincia;
import ec.edu.espe_ctt_investigacion.session.SeaCantonFacade;
import ec.edu.espe_ctt_investigacion.session.SeaParroquiaFacade;
import ec.edu.espe_ctt_investigacion.session.SeaProvinciaFacade;
import java.io.Serializable;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.util.ArrayList;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import javax.annotation.PostConstruct;
import javax.ejb.EJB;
import javax.faces.bean.ManagedBean;
import javax.faces.bean.ViewScoped;
import org.primefaces.event.data.SortEvent;

/**
 *
 * @author Administrador
 */
@ManagedBean
@ViewScoped
public class ReportesProgramasController implements Serializable {

    @EJB
    private StvcampFacade sedesFacade;

    @EJB
    private SeaProvinciaFacade provinciasFacade;
    @EJB
    private SeaCantonFacade cantonesFacade;
    @EJB
    private SeaParroquiaFacade parroquiasFacade;
    @EJB
    private VDocenteVinculacion2Facade vistaDocenteFacade;
    @EJB
    private StvmajrFacade carrerasFacade;
    @EJB

    private ProgramaFacade programaFacade;

    @EJB
    private StvsubjFacade departamentoFacade;
    private List<Stvsubj> departamentos;
    private List<Stvmajr> carreras;
    private Date fechaDesde;
    private Date fechaHasta;
    private List<SeaProvincia> provincias;
    private List<SeaCanton> cantones;
    private List<SeaParroquia> parroquias;
    private List<Cobertura> coberturaList;
    private List<Programa> programas;
    private List<Stvcamp> sedes;
    private List<Estado> estadoList;

    public ReportesProgramasController() {
    }

    @PostConstruct
    public void init() {
        this.departamentos = departamentoFacade.findAll();
        this.programas = programaFacade.findXEstado("");
        this.carreras = carrerasFacade.findAll();
        this.sedes = sedesFacade.findAll();
        this.provincias = provinciasFacade.findAll();
        this.cantones = cantonesFacade.findAll();
        this.parroquias = parroquiasFacade.findAll();

        coberturaList = new ArrayList<>();
        coberturaList.add(new Cobertura("1", "Nacional"));
        coberturaList.add(new Cobertura("2", "Provincial"));
        coberturaList.add(new Cobertura("3", "Cantonal"));
        coberturaList.add(new Cobertura("4", "Parroquial"));

        estadoList = new ArrayList<>();
        estadoList.add(new Estado("CRE", "INGRESO DE PERFIL"));
        estadoList.add(new Estado("CEP", "EN EJECUCION"));
        estadoList.add(new Estado("CES", "EN CIERRE"));
        estadoList.add(new Estado("CER", "EN EVALUACION"));
        estadoList.add(new Estado("EVA", "EVALUADO"));
        
        
        visualizarDirector=true;
        visualizarEstado=true;
        visualizarFechaInicio=true;
        visualizarFechaFinalizacion=true;
    }

    private enum COLUMNA {
        PROGRAMA, PROYECTO, CODIGO_PROYECTO, ESTADO, TIPO_PROYECTO, DIRECTOR, CAMPUS, DEPARTAMENTO, COBERTURA, LINEA_INVESTIGACION, CARRERA, CAMPUS_PARTICIPANTE, DEPARTAMENTO_PARTICIPANTE, PROVINCIA, CANTON, PARROQUIA, DOCENTE_PARTICIPANTE, ESTUDIANTE_PARTICIPANTE, PRESUPUESTO_PARTIDA
    }
    private COLUMNA columnaOrdenada;

    public COLUMNA getColumnaOrdenada() {
        return columnaOrdenada;
    }

    public void setColumnaOrdenada(COLUMNA columnaOrdenada) {
        this.columnaOrdenada = columnaOrdenada;
    }

    public void detectSortEvent(SortEvent event) {
        if (event.getSortColumn().getClientId().contains(":colProyecto")) {
            columnaOrdenada = COLUMNA.PROYECTO;
        } else if (event.getSortColumn().getClientId().contains(":colEstado")) {
            columnaOrdenada = COLUMNA.ESTADO;
        }

    }
    private List<Programa> programaList;
    private List<ProgramaReporte> programasReporteList;

    public Boolean verificarFiltro(Integer filtroReporte) {
        switch (filtroReporte) {
            case 1:
                for (Programa p : programas) {
                    if (p.getSelected() != null && p.getSelected()) {
                        return true;

                    }

                }
                break;
            case 2:
                for (Estado p : estadoList) {
                    if (p.getSelected() != null && p.getSelected()) {
                        return true;
                    }
                }
                break;
            case 3:
                for (Stvmajr p : carreras) {
                    if (p.getSelected() != null && p.getSelected()) {
                        return true;
                    }
                }
                break;
            case 4:
                for (Cobertura p : coberturaList) {
                    if (p.getSelected() != null && p.getSelected()) {
                        return true;
                    }
                }
                break;
            case 5:
                for (SeaProvincia p : provincias) {
                    if (p.getSelected() != null && p.getSelected()) {
                        return true;
                    }
                }
                break;
            case 6:
                for (SeaCanton p : cantones) {
                    if (p.getSelected() != null && p.getSelected()) {
                        return true;
                    }
                }
                break;
            case 7:
                for (SeaParroquia p : parroquias) {
                    if (p.getSelected() != null && p.getSelected()) {
                        return true;
                    }
                }
                break;
        }
        return false;
    }

    public String getFiltroReporteStr() {
        switch (filtroReporte) {
            case 1:
                return "Programa";
            case 2:
                return "Estado";
            case 3:
                return "Carrera";
            case 4:
                return "Cobertura";
            case 5:
                return "Provincia";
            case 6:
                return "Cant√≥n";
            case 7:
                return "Parroquia";
            default:
                break;
        }
        return "";
    }

    private boolean visualizarTodos;
    private boolean visualizarEstado;
    private boolean visualizarFechaInicio;
    private boolean visualizarFechaFinalizacion;
    private boolean visualizarDirector;
    private boolean visualizarProyectos;
    private boolean visualizarCarrera;
    private boolean visualizarProvincia;
    private boolean visualizarCanton;
    private boolean visualizarParroquia;
    private boolean visualizarEvaluacionFinal;

    public List<Stvmajr> getCarreras() {
        return carreras;
    }

    public void setCarreras(List<Stvmajr> carreras) {
        this.carreras = carreras;
    }

    public boolean isVisualizarEvaluacionFinal() {
        return visualizarEvaluacionFinal;
    }

    public void setVisualizarEvaluacionFinal(boolean visualizarEvaluacionFinal) {
        this.visualizarEvaluacionFinal = visualizarEvaluacionFinal;
    }

    public boolean isVisualizarProvincia() {
        return visualizarProvincia;
    }

    public void setVisualizarProvincia(boolean visualizarProvincia) {
        this.visualizarProvincia = visualizarProvincia;
    }

    public boolean isVisualizarCanton() {
        return visualizarCanton;
    }

    public void setVisualizarCanton(boolean visualizarCanton) {
        this.visualizarCanton = visualizarCanton;
    }

    public boolean isVisualizarParroquia() {
        return visualizarParroquia;
    }

    public void setVisualizarParroquia(boolean visualizarParroquia) {
        this.visualizarParroquia = visualizarParroquia;
    }

    public boolean isVisualizarProyectos() {
        return visualizarProyectos;
    }

    public void setVisualizarProyectos(boolean visualizarProyectos) {
        this.visualizarProyectos = visualizarProyectos;
    }

    private ProgramaReporte crearObjetoReportePrograma(Programa programa) {
        ProgramaReporte reportePrograma = new ProgramaReporte();
        reportePrograma.setId(programa.getId());

        reportePrograma.setNombre(programa.getNombre().toUpperCase());
        reportePrograma.setEstado(new Estado(programa.getEstado(), programa.getEstadoStr().toUpperCase()));
        reportePrograma.setCobertura(programa.getCoberturaStr().toUpperCase());
        VDocenteVinculacion2 doc = vistaDocenteFacade.findByUsuId(programa.getDirector().getUsuario().getUsuId());
        ResponsableProyecto director = new ResponsableProyecto();
        director.setUsuario(doc.getUsuario());
        director.setCampus(doc.getCampus());
        director.setDepartamento(doc.getDepartamento());
        reportePrograma.setDirector(director);
        reportePrograma.setFechaInicio(programa.getFechaInicio());
        reportePrograma.setFechaFinalizacion(programa.getFechaCierre());

        /*for (Proyecto proy : programa.getProyectoActivoList()) {
            proy.getPuntajeEvaluacionPertinencia();
            
        }*/
 /*reportePrograma.setEvaluacionPertinencia(programa.getPuntajeEvaluacionPertinencia());
        reportePrograma.setEvaluacionEficacia(proyecto.getPuntajeEvaluacionEficacia());
        reportePrograma.setEvaluacionEficiencia(proyecto.getPuntajeEvaluacionEficiencia());
        reportePrograma.setEvaluacionSostenibilidad(proyecto.getPuntajeEvaluacionSostenibilidad());
        reportePrograma.setEvaluacionSobre(proyecto.getPuntajeEvaluacionSobre());
        reportePrograma.setEvaluacionTotal(proyecto.getPuntajeEvaluacionTotal());
        reportePrograma.setNroBeneficiariosDirectosDiscapac(proyecto.getNroBeneficiariosDirectosDiscapac());
        
        reporteProyecto.setNroBeneficiariosDirectosHombres(proyecto.getNroBeneficiariosDirectosHombres());
        reporteProyecto.setNroBeneficiariosDirectosMujeres(proyecto.getNroBeneficiariosDirectosMujeres());
        reporteProyecto.setNroBeneficiariosDirectosNinios(proyecto.getNroBeneficiariosDirectosNinios());
        reporteProyecto.setNroBeneficiariosIndirectos(proyecto.getNroBeneficiariosIndirectos());
        reporteProyecto.setTotalBeneficiariosPlanificados(proyecto.getTotalBeneficiariosPlanificado());
        reporteProyecto.setNroBeneficiariosDirectosDiscapacEjec(proyecto.getTotalBeneficiariosDirectosEjecutadosDiscapacidad());
        reporteProyecto.setNroBeneficiariosDirectosHombresEjec(proyecto.getTotalBeneficiariosDirectosEjecutadosHombres());
        reporteProyecto.setNroBeneficiariosDirectosMujeresEjec(proyecto.getTotalBeneficiariosDirectosEjecutadosMujeres());
        reporteProyecto.setNroBeneficiariosDirectosNiniosEjec(proyecto.getTotalBeneficiariosDirectosEjecutadosNinios());
        reporteProyecto.setNroBeneficiariosIndirectosEjec(proyecto.getTotalBeneficiariosIndirectosEjecutados());
        reporteProyecto.setTotalBeneficiariosEjecutados(proyecto.getTotalBeneficiariosEjecutados());
        reporteProyecto.setPoblacionBeneficiariaUrbanoMarginal(proyecto.isTipoPoblacionBeneficiariaUrbanoMarginal());
        reporteProyecto.setPoblacionBeneficiariaRural(proyecto.isTipoPoblacionBeneficiariaRural());
        reporteProyecto.setPoblacionBeneficiariaGrupoAtencionPrioritaria(proyecto.isTipoPoblacionGrupoAtencionPrioritaria());
        reporteProyecto.setPresupuestoTotalPlanificado(proyecto.getTotalPresupuesto());
        reporteProyecto.setPresupuestoTotalEjecutado(proyecto.getTotalPresupuestoEjecutado());
        if (proyecto.getMensajePermitirCalificacionComisionVinculacion().equals("")) {
            reporteProyecto.setDocumentacionPerfil(true);
        }
        if (proyecto.verificarCronogramaIngresado()) {
            reporteProyecto.setDocumentacionCronograma(true);
        }
        if (proyecto.getPresupuestoProyectoList() != null && !proyecto.getPresupuestoProyectoList().isEmpty()) {
            reporteProyecto.setDocumentacionCosteo(true);
        }
        if (proyecto.getCompromisoParticipacionList() != null && !proyecto.getCompromisoParticipacionList().isEmpty()) {
            reporteProyecto.setDocumentacionCompromisoParticipacion(true);
        }
        if (proyecto.getTotalBeneficiariosPlanificado() != null && proyecto.getTotalBeneficiariosPlanificado() != 0) {
            reporteProyecto.setDocumentacionBeneficiarios(true);
        }
        if (proyecto.getParticipanteDocenteList() != null && !proyecto.getParticipanteDocenteList().isEmpty()) {
            reporteProyecto.setDocumentacionNroDocentes(true);
        }
        if (proyecto.getParticipanteEstudianteList() != null && !proyecto.getParticipanteEstudianteList().isEmpty()) {
            reporteProyecto.setDocumentacionNroEstudiantes(true);
        }
        if (proyecto.getObjetivoProyectoList() != null && !proyecto.getObjetivoProyectoList().isEmpty()) {
            for (ObjetivoPrograma obj : proyecto.getObjetivoProyectoList()) {
                if (obj.getSeguimientoProyectoActual().getAvanceActividadList() != null && !obj.getSeguimientoProyectoActual().getAvanceActividadList().isEmpty()) {
                    reporteProyecto.setDocumentacionAvance(true);
                    break;
                }
            }
        }
        if (proyecto.getParticipanteDocenteList() != null && !proyecto.getParticipanteDocenteList().isEmpty()) {
            for (ResponsableProyecto resp : proyecto.getParticipanteDocenteList()) {
                if (resp.getTotalHorasDedicadas() > 0) {
                    reporteProyecto.setDocumentacionHorasDocentes(true);
                    break;
                }
            }
        }
        if (proyecto.getParticipanteEstudianteList() != null && !proyecto.getParticipanteEstudianteList().isEmpty()) {
            for (ResponsableProyecto resp : proyecto.getParticipanteEstudianteList()) {
                if (resp.getTotalHorasDedicadas() > 0) {
                    reporteProyecto.setDocumentacionHorasEstudiantes(true);
                    break;
                }
            }
        }
        if (proyecto.getMensajePermitirEvaluacionFinal().equals("")) {
            reporteProyecto.setDocumentacionCierre(true);
        }
        if (proyecto.getEstado().equals(Proyecto.ESTADO_EVALUADO)) {
            reporteProyecto.setDocumentacionEvaluacionFinal(true);
        }
        proyecto.initAnexos();
        if (proyecto.getAnexoDocumentoProyectoList() != null && !proyecto.getAnexoDocumentoProyectoList().isEmpty()) {
            reporteProyecto.setDocumentacionAnexos(true);
        }
         */
        return reportePrograma;
    }

    private Integer filtroReporte;

    public Integer getFiltroReporte() {
        return filtroReporte;
    }

    public void setFiltroReporte(Integer filtroReporte) {
        this.filtroReporte = filtroReporte;
    }

    public void cancelarFiltro(Integer filtroReporte) {
        switch (filtroReporte) {
            case 1:
                for (Programa p : programas) {
                    p.setSelected(Boolean.FALSE);
                }
                break;
            case 2:
                for (Estado p : estadoList) {
                    p.setSelected(Boolean.FALSE);
                }
                break;
            case 3:
                for (Stvmajr p : carreras) {
                    p.setSelected(Boolean.FALSE);
                }
                break;
            case 4:
                for (Cobertura p : coberturaList) {
                    p.setSelected(Boolean.FALSE);
                }
                break;
            case 5:
                for (SeaProvincia p : provincias) {
                    p.setSelected(Boolean.FALSE);
                }
                break;
            case 6:
                for (SeaCanton p : cantones) {
                    p.setSelected(Boolean.FALSE);
                }
                break;
            case 7:
                for (SeaParroquia p : parroquias) {
                    p.setSelected(Boolean.FALSE);
                }
                break;
        }
    }

    private void filtrarProgramas() {
        //Filtro por programas
        if (verificarFiltro(1)) {
            Iterator it = programaList.iterator();
            while (it.hasNext()) {
                Programa prog = (Programa) it.next();
                boolean encontro = false;
                for (Programa progFiltro : programas) {
                    if (progFiltro.getSelected() != null && progFiltro.getSelected() && progFiltro.equals(prog)) {
                        encontro = true;
                        break;
                    }
                }
                if (!encontro) {
                    it.remove();
                }
            }
        }

        //Filtro por estado
        if (verificarFiltro(2)) {
            Iterator it = programaList.iterator();
            while (it.hasNext()) {
                Programa prog = (Programa) it.next();
                boolean encontro = false;
                for (Estado estadoFiltro : estadoList) {
                    if (estadoFiltro.getSelected() != null && estadoFiltro.getSelected()) {
                        if (estadoFiltro.getId().equals(prog.getEstado())) {
                            encontro = true;
                            break;
                        }
                    }
                }
                if (!encontro) {
                    it.remove();
                }
            }
        }

        //Filtro por carrera
        if (verificarFiltro(3)) {
            Iterator it = programaList.iterator();
            while (it.hasNext()) {
                Programa prog = (Programa) it.next();
                boolean encontro = false;
                for (Stvmajr carreraFiltro : carreras) {
                    if (carreraFiltro.getSelected() != null && carreraFiltro.getSelected()) {
                        for (CarreraPrograma car : prog.getCarreraProgramaList()) {
                            if (carreraFiltro.equals(car.getCarrera())) {
                                encontro = true;
                                break;
                            }

                        }
                        if (encontro) {
                            break;
                        }
                    }
                }
                if (!encontro) {
                    it.remove();
                }
            }
        }

        //Filtro por cobertura
        if (verificarFiltro(4)) {
            Iterator it = programaList.iterator();
            while (it.hasNext()) {
                Programa prog = (Programa) it.next();
                boolean encontro = false;
                for (Cobertura cobertura : coberturaList) {
                    if (cobertura.getSelected() != null && cobertura.getSelected() && cobertura.getId().equals(prog.getCobertura().toString())) {
                        encontro = true;
                        break;
                    }
                }
                if (!encontro) {
                    it.remove();
                }
            }
        }

        //Filtro por Provincia
        if (verificarFiltro(5)) {
            Iterator it = programaList.iterator();
            while (it.hasNext()) {
                Programa prog = (Programa) it.next();
                boolean encontro = false;
                for (SeaProvincia provinciaFiltro : provincias) {
                    if (provinciaFiltro.getSelected() != null && provinciaFiltro.getSelected()) {
                        for (LocalizacionPrograma car : prog.getLocalizacionDistinctProvinciaList()) {
                            if (provinciaFiltro.equals(car.getProvincia())) {
                                encontro = true;
                                break;
                            }

                        }
                        if (encontro) {
                            break;
                        }
                    }
                }
                if (!encontro) {
                    it.remove();
                }
            }
        }

        //Filtro por Canton
        if (verificarFiltro(6)) {
            Iterator it = programaList.iterator();
            while (it.hasNext()) {
                Programa prog = (Programa) it.next();
                boolean encontro = false;
                for (SeaCanton cantonFiltro : cantones) {
                    if (cantonFiltro.getSelected() != null && cantonFiltro.getSelected()) {
                        for (LocalizacionPrograma car : prog.getLocalizacionDistinctCantonList()) {
                            if (cantonFiltro.equals(car.getCanton())) {
                                encontro = true;
                                break;
                            }

                        }
                        if (encontro) {
                            break;
                        }
                    }
                }
                if (!encontro) {
                    it.remove();
                }
            }
        }

        //Filtro por Parroquia
        if (verificarFiltro(7)) {
            Iterator it = programaList.iterator();
            while (it.hasNext()) {
                Programa prog = (Programa) it.next();
                boolean encontro = false;
                for (SeaParroquia parroquiaFiltro : parroquias) {
                    if (parroquiaFiltro.getSelected() != null && parroquiaFiltro.getSelected()) {
                        for (LocalizacionPrograma car : prog.getLocalizacionDistinctParroquiaList()) {
                            if (parroquiaFiltro.equals(car.getParroquia())) {
                                encontro = true;
                                break;
                            }

                        }
                        if (encontro) {
                            break;
                        }
                    }
                }
                if (!encontro) {
                    it.remove();
                }
            }
        }

    }

    public void generarReporte() {
        columnaOrdenada = null;
        programasReporteList = new ArrayList<>();
        programaList = programaFacade.findAll();
        Iterator it = programaList.iterator();
        while (it.hasNext()) {
            Programa p = (Programa) it.next();
            if (fechaDesde != null && p.getFechaInicio() != null && p.getFechaInicio().before(fechaDesde)) {
                it.remove();
                continue;
            }
            if (fechaHasta != null && (p.getFechaCierre() == null || p.getFechaCierre().after(fechaHasta))) {
                it.remove();
            }
        }
        filtrarProgramas();
        //agregaEvaluacionFinal();

        for (Programa p : programaList) {
            if ((p.getProyectoActivoList() == null || p.getProyectoActivoList().isEmpty())
                    && (p.getDepartamentoProgramaList() == null || p.getDepartamentoProgramaList().isEmpty())
                    && (p.getCarreraProgramaList() == null || p.getCarreraProgramaList().isEmpty())
                    && (p.getObjetivosProvCanParr() == null || p.getObjetivosProvCanParr().isEmpty())) {
                programasReporteList.add(crearObjetoReportePrograma(p));
            }
        }

        //Carreras
        for (Programa p : programaList) {
            List<CarreraPrograma> lista = p.getCarreraProgramaList();
            if (lista == null || lista.isEmpty() || !visualizarCarrera) {
                agregarPrograma(p);
            } else if (visualizarCarrera) {
                for (CarreraPrograma item : lista) {
                    agregarProgramaCarrera(p, item.getCarrera());
                }
            }
        }

        //Provincias
        for (Programa p : programaList) {
            List<LocalizacionPrograma> lista = p.getLocalizacionDistinctProvinciaList();
            if (lista == null || lista.isEmpty() || !visualizarProvincia) {
                agregarPrograma(p);
            } else if (visualizarProvincia) {
                for (LocalizacionPrograma item : lista) {
                    agregarProgramaProvincia(p, item.getProvincia());
                }
            }
        }

        //Cantones
        for (Programa p : programaList) {
            List<LocalizacionPrograma> lista = p.getLocalizacionDistinctCantonList();
            if (lista == null || lista.isEmpty() || !visualizarCanton) {
                agregarPrograma(p);
            } else if (visualizarCanton) {
                for (LocalizacionPrograma item : lista) {
                    agregarProgramaCanton(p, item.getCanton());
                }
            }
        }

        //Parroquias
        for (Programa p : programaList) {
            List<LocalizacionPrograma> lista = p.getLocalizacionDistinctParroquiaList();
            if (lista == null || lista.isEmpty() || !visualizarParroquia) {
                agregarPrograma(p);
            } else if (visualizarParroquia) {
                for (LocalizacionPrograma item : lista) {
                    agregarProgramaParroquia(p, item.getParroquia());
                }
            }
        }

        for (ProgramaReporte p : programasReporteList) {
            if (p.getCarrera() == null) {
                p.setCarrera(new Stvmajr("-1", ""));
            }
            if (p.getCampusParticipante() == null) {
                p.setCampusParticipante(new Stvcamp("-1", ""));
            }
            if (p.getDepartamentoParticipante() == null) {
                p.setDepartamentoParticipante(new Stvsubj("-1", ""));
            }
            if (p.getProvincia() == null) {
                p.setProvincia(new SeaProvincia("-1", ""));
            }
            if (p.getCanton() == null) {
                p.setCanton(new SeaCanton("-1", ""));
            }
            if (p.getParroquia() == null) {
                p.setParroquia(new SeaParroquia("-1", ""));
            }
        }

    }

    private enum TipoBusqueda {
        DEPARTAMENTO, CARRERA, PROVINCIA, CANTON, PARROQUIA
    }

    private List<ProgramaReporte> buscarProgramas(Integer idPrograma, TipoBusqueda tipoBusqueda) {
        List<ProgramaReporte> result = new ArrayList<>();
        for (ProgramaReporte p : programasReporteList) {
            if (p.getId().equals(idPrograma)) {
                if (tipoBusqueda == null) {
                    result.add(p);
                } else if (tipoBusqueda.equals(TipoBusqueda.DEPARTAMENTO)) {
                    if (p.getDepartamentoParticipante() == null) {
                        result.add(p);
                    }
                } else if (tipoBusqueda.equals(TipoBusqueda.CARRERA)) {
                    if (p.getCarrera() == null) {
                        result.add(p);
                    }
                } else if (tipoBusqueda.equals(TipoBusqueda.PROVINCIA)) {
                    if (p.getProvincia() == null) {
                        result.add(p);
                    }
                } else if (tipoBusqueda.equals(TipoBusqueda.CANTON)) {
                    if (p.getCanton() == null) {
                        result.add(p);
                    }
                } else if (tipoBusqueda.equals(TipoBusqueda.PARROQUIA)) {
                    if (p.getParroquia() == null) {
                        result.add(p);
                    }
                }
            }
        }
        return result;
    }

    private List<ProgramaReporte> buscarProgramas(Integer idPrograma, String idBuscar, TipoBusqueda tipoBusqueda) {
        List<ProgramaReporte> result = new ArrayList<>();
        for (ProgramaReporte p : programasReporteList) {
            if (p.getId().equals(idPrograma)) {
                if (tipoBusqueda.equals(TipoBusqueda.DEPARTAMENTO)) {
                    if (p.getDepartamentoParticipante() != null && p.getDepartamentoParticipante().getStvsubjCode().equals(idBuscar)) {
                        result.add(p);
                    }
                }
                if (tipoBusqueda.equals(TipoBusqueda.CARRERA)) {
                    if (p.getCarrera().getStvmajrCode().equals(idBuscar)) {
                        result.add(p);
                    }
                }
                if (tipoBusqueda.equals(TipoBusqueda.PROVINCIA)) {
                    if (p.getProvincia().getProId().equals(idBuscar)) {
                        result.add(p);
                    }
                }
                if (tipoBusqueda.equals(TipoBusqueda.CANTON)) {
                    if (p.getCanton().getCanId().equals(idBuscar)) {
                        result.add(p);
                    }
                }
                if (tipoBusqueda.equals(TipoBusqueda.PARROQUIA)) {
                    if (p.getParroquia().getPrqId().equals(idBuscar)) {
                        result.add(p);
                    }
                }
            }
        }
        return result;
    }

    private void agregarPrograma(Programa p) {
        if (buscarProgramas(p.getId(), null).isEmpty()) {
            ProgramaReporte prog = crearObjetoReportePrograma(p);
            programasReporteList.add(prog);
        }
    }

    private void agregarProgramaCarrera(Programa programa, Stvmajr carrera) {
        boolean encontro = false;
        for (ProgramaReporte p : buscarProgramas(programa.getId(), TipoBusqueda.CARRERA)) {
            p.setCarrera(carrera);
            encontro = true;
        }
        if (!encontro) {
            String idBuscar = null;
            for (ProgramaReporte p : programasReporteList) {
                if (p.getId().equals(programa.getId()) && p.getCarrera() != null) {
                    idBuscar = p.getCarrera().getStvmajrCode();
                    break;
                }
            }
            if (idBuscar == null) {
                boolean encontro2 = false;
                for (ProgramaReporte p : buscarProgramas(programa.getId(), null)) {
                    p.setCarrera(carrera);
                    encontro2 = true;
                }
                if (!encontro2) {
                    ProgramaReporte prog = crearObjetoReportePrograma(programa);
                    prog.setCarrera(carrera);
                    programasReporteList.add(prog);
                }
            } else {
                for (ProgramaReporte p : buscarProgramas(programa.getId(), idBuscar, TipoBusqueda.CARRERA)) {
                    ProgramaReporte programaReporteNuevo = p.clon();
                    programaReporteNuevo.setCarrera(carrera);
                    programasReporteList.add(programaReporteNuevo);
                }
            }

        }
    }

    private void agregarProgramaProvincia(Programa programa, SeaProvincia provincia) {
        boolean encontro = false;
        for (ProgramaReporte p : buscarProgramas(programa.getId(), TipoBusqueda.PROVINCIA)) {
            p.setProvincia(provincia);
            encontro = true;
        }
        if (!encontro) {
            String idBuscar = null;
            for (ProgramaReporte p : programasReporteList) {
                if (p.getId().equals(programa.getId()) && p.getProvincia() != null) {
                    idBuscar = p.getProvincia().getProId();
                    break;
                }
            }
            if (idBuscar == null) {
                boolean encontro2 = false;
                for (ProgramaReporte p : buscarProgramas(programa.getId(), null)) {
                    p.setProvincia(provincia);
                    encontro2 = true;
                }
                if (!encontro2) {
                    ProgramaReporte prog = crearObjetoReportePrograma(programa);
                    prog.setProvincia(provincia);
                    programasReporteList.add(prog);
                }
            } else {
                for (ProgramaReporte p : buscarProgramas(programa.getId(), idBuscar, TipoBusqueda.PROVINCIA)) {
                    ProgramaReporte programaReporteNuevo = p.clon();
                    programaReporteNuevo.setProvincia(provincia);
                    programasReporteList.add(programaReporteNuevo);
                }

            }
        }
    }

    private void agregarProgramaCanton(Programa programa, SeaCanton canton) {
        boolean encontro = false;
        for (ProgramaReporte p : buscarProgramas(programa.getId(), TipoBusqueda.CANTON)) {
            if (p.getProvincia() != null && p.getProvincia().equals(canton.getProId())) {
                p.setCanton(canton);
                encontro = true;
            }
        }
        if (!encontro) {
            String idBuscar = null;
            for (ProgramaReporte p : programasReporteList) {
                if (p.getId().equals(programa.getId()) && p.getCanton() != null) {
                    idBuscar = p.getCanton().getCanId();
                    break;
                }
            }
            if (idBuscar == null) {
                boolean encontro2 = false;
                for (ProgramaReporte p : buscarProgramas(programa.getId(), null)) {
                    p.setCanton(canton);
                    encontro2 = true;
                }
                if (!encontro2) {
                    ProgramaReporte proy = crearObjetoReportePrograma(programa);
                    proy.setCanton(canton);
                    programasReporteList.add(proy);
                }
            } else {
                for (ProgramaReporte p : buscarProgramas(programa.getId(), idBuscar, TipoBusqueda.CANTON)) {
                    ProgramaReporte programaReporteNuevo = p.clon();
                    programaReporteNuevo.setCanton(canton);
                    programasReporteList.add(programaReporteNuevo);
                }

            }
        }
    }

    private void agregarProgramaParroquia(Programa programa, SeaParroquia parroquia) {
        boolean encontro = false;
        for (ProgramaReporte p : buscarProgramas(programa.getId(), TipoBusqueda.PARROQUIA)) {
            if (p.getCanton() != null && p.getCanton().equals(parroquia.getCanId())) {
                p.setParroquia(parroquia);
                encontro = true;
            }
        }
        if (!encontro) {
            String idBuscar = null;
            for (ProgramaReporte p : programasReporteList) {
                if (p.getId().equals(programa.getId()) && p.getParroquia() != null) {
                    idBuscar = p.getParroquia().getPrqId();
                    break;
                }
            }
            if (idBuscar == null) {
                boolean encontro2 = false;
                for (ProgramaReporte p : buscarProgramas(programa.getId(), null)) {
                    p.setParroquia(parroquia);
                    encontro2 = true;
                }
                if (!encontro2) {
                    ProgramaReporte proy = crearObjetoReportePrograma(programa);
                    proy.setParroquia(parroquia);
                    programasReporteList.add(proy);
                }
            } else {
                for (ProgramaReporte p : buscarProgramas(programa.getId(), idBuscar, TipoBusqueda.PARROQUIA)) {
                    ProgramaReporte programasReporteNuevo = p.clon();
                    programasReporteNuevo.setParroquia(parroquia);
                    programasReporteList.add(programasReporteNuevo);
                }

            }
        }
    }

    public Date getFechaDesde() {
        return fechaDesde;
    }

    public void setFechaDesde(Date fechaDesde) {
        this.fechaDesde = fechaDesde;
    }

    public Date getFechaHasta() {
        return fechaHasta;
    }

    public void setFechaHasta(Date fechaHasta) {
        this.fechaHasta = fechaHasta;
    }

    public boolean isVisualizarTodos() {
        return visualizarTodos;
    }

    public void setVisualizarTodos(boolean visualizarTodos) {
        this.visualizarTodos = visualizarTodos;
    }

    public boolean isVisualizarCarrera() {
        return visualizarCarrera;
    }

    public void setVisualizarCarrera(boolean visualizarCarrera) {
        this.visualizarCarrera = visualizarCarrera;
    }

    public void seleccionarDeseleccionarTodos() {
        visualizarCanton = visualizarTodos;
        visualizarCarrera = visualizarTodos;
        visualizarEvaluacionFinal = visualizarTodos;
        visualizarParroquia = visualizarTodos;
        visualizarProvincia = visualizarTodos;
        visualizarProyectos = visualizarTodos;
        visualizarDirector = visualizarTodos;
        visualizarEstado = visualizarTodos;
        visualizarFechaFinalizacion = visualizarTodos;
        visualizarFechaInicio = visualizarTodos;
    }

    public void seleccionarFiltro() {

        filtroReporte = null;
    }

    public List<Stvsubj> getDepartamentos() {
        return departamentos;
    }

    public void setDepartamentos(List<Stvsubj> departamentos) {
        this.departamentos = departamentos;
    }

    public List<SeaProvincia> getProvincias() {
        return provincias;
    }

    public void setProvincias(List<SeaProvincia> provincias) {
        this.provincias = provincias;
    }

    public List<SeaCanton> getCantones() {
        return cantones;
    }

    public void setCantones(List<SeaCanton> cantones) {
        this.cantones = cantones;
    }

    public List<SeaParroquia> getParroquias() {
        return parroquias;
    }

    public void setParroquias(List<SeaParroquia> parroquias) {
        this.parroquias = parroquias;
    }

    public List<Cobertura> getCoberturaList() {
        return coberturaList;
    }

    public void setCoberturaList(List<Cobertura> coberturaList) {
        this.coberturaList = coberturaList;
    }

    public List<Stvcamp> getSedes() {
        return sedes;
    }

    public void setSedes(List<Stvcamp> sedes) {
        this.sedes = sedes;
    }

    public List<Estado> getEstadoList() {
        return estadoList;
    }

    public void setEstadoList(List<Estado> estadoList) {
        this.estadoList = estadoList;
    }

    public List<Programa> getProgramaList() {
        return programaList;
    }

    public void setProgramaList(List<Programa> programaList) {
        this.programaList = programaList;
    }

    public List<ProgramaReporte> getProgramasReporteList() {
        return programasReporteList;
    }

    public void setProgramasReporteList(List<ProgramaReporte> programasReporteList) {
        this.programasReporteList = programasReporteList;
    }

    public List<Programa> getProgramas() {
        return programas;
    }

    public void setProgramas(List<Programa> programas) {
        this.programas = programas;
    }

    public boolean isVisualizarEstado() {
        return visualizarEstado;
    }

    public void setVisualizarEstado(boolean visualizarEstado) {
        this.visualizarEstado = visualizarEstado;
    }

    public boolean isVisualizarFechaInicio() {
        return visualizarFechaInicio;
    }

    public void setVisualizarFechaInicio(boolean visualizarFechaInicio) {
        this.visualizarFechaInicio = visualizarFechaInicio;
    }

    public boolean isVisualizarFechaFinalizacion() {
        return visualizarFechaFinalizacion;
    }

    public void setVisualizarFechaFinalizacion(boolean visualizarFechaFinalizacion) {
        this.visualizarFechaFinalizacion = visualizarFechaFinalizacion;
    }

    public boolean isVisualizarDirector() {
        return visualizarDirector;
    }

    public void setVisualizarDirector(boolean visualizarDirector) {
        this.visualizarDirector = visualizarDirector;
    }

}
